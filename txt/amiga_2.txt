Amiga

Plug and play? Nikoliv, AUTOCONFIG!

Nejzaklínanějším reklamním sloganem současnosti v oblasti PC je bezpochyby ono “plug and play” (zastrč a jeď), slibující uživatelům PC, vystrašeným složitostí konfigurace svého pracovního (nebo odpočinkového) nástroje, požitek z bezstarostné jízdy. Naděje se obvykle rozplývá zakoupením první přídavné karty, vykřikující pomocí všech barev ze svého obalu ono plug and play. K obvyklým potížím s nastavením přerušovacích jumperů (které jako poslední stéblo naděje nové karty plug and play obvykle neobsahují) přibývají potíže nové, a to jak sladit různé úrovně slibovaného standardu na základní desce, v BIOS, v PCMCIA socket services, v síťové kartě atd., atd.
Porozhlédněme se nyní, jak problém obsluhy přídavných karet řeší Amiga. Obsluha přídavné karty (od jednoduchého portu pro spínání světýlek až po složité karty pro digitální videostřih) se dělí na dvě části. První část sděluje systému, kde se karta v paměti počítače nachází. Druhá informuje o tom, jakým způsobem obsloužit její nároky.
Za skalních dob PC se problém lokalizace karty v systému řešil pomocí známých jumperů neboli přepínačů, jejichž kombinace určovala jednu z několika málo pevně určených možností, kde se nachází tzv. bázová adresa. Stejným způsobem (tj. další sadou jumperů) se definovalo číslo přerušení, pomocí něhož se karta dala obsluhovat. Možností přerušení bylo (a je) ještě méně než bázových adres. A tak zkonfigurovat PC (dejme tomu se čtyřmi přídavnými kartami) patří k vrcholu počítačového umění, kterým se zabývají dobře placení odborníci.
Ovšem už za dob, kdy se nadšení amatéři (z nichž se, jak tušíte, postu-pem času a nezměrnou pílí stali výše zmínění odborníci) prokousávali stohy manuálů a pocvičovali se v kombinatorice, bylo tu něco jiného, co nabízelo bez reklamní mediální kampaně řešení naznačených problémů.
Tím řešením je AUTOCONFIG, protokol (dnes ovšem honosněji řečeno technologie) pomáhající už deset let identifikovat a nastavit libovolnou přídavnou kartu Amigy. K AUTOCONFIGU se připojuje obsluha přerušení, kterou obsahuje jádro operačního systému, tzv. Exec. Základem pružnosti konfigurace přídavných karet je to, že jejich architektura je relokovatelná, tj. mohou se nacházet na téměř libovolné adrese v paměti. Konfigurace karty totiž na Amize probíhá přesně obráceně než na PC. Karta neurčuje svoji adresu v paměti, ale operační systém přiděluje bázovou adresu kartě zápisem do jediného registru. Jak ale zajistit, aby byly všechny karty v pořádku přihlášeny? Karty jsou seřazeny ve frontě (která se dost podobá obsluze přerušení u mikroprocesoru Zilog blahé paměti) a první karta vyčkává na pozici $E80000,  až se o ni systém za pomoci expan- sion.library začne zajímat. Ihned po rozjezdu systému a kontrole operační paměti začne tato knihovna pracovat. Z pevně určené struktury na adrese $E80000 vyčte o kartě všechny důležité údaje, jako je typ, požadovaná velikost paměti, identifikace výrobce apod. Nachází-li se na kartě ovladač v ROM, překopíruje ho do paměti (veškerý software Amigy je relokovatelný) a po ukončení iniciace sdělí kartě její novou adresu. Od tohoto okamžiku se uvolní adresa $E80000. Na ní se octne další karta a vše se opakuje, dokud nejsou přihlášeny všechny karty. Ovladače karet se nacházejí v sys: expansions nebo sys: adresáři - vyjma karet, které si nesou ovladač s sebou v paměti ROM, jak bylo zmíněno výše.
Karty jsou rozdány, teď jenom jak s nimi míchat. Všechny přídavné karty na počítačích, a v tom se jednotlivé rodiny počítačů moc neliší, se o svá práva přihlašují pomocí přerušení. Nastane-li přerušení, procesor přestane vykonávat hlavní program a obslouží naléhající zařízení. Na kompatibilním PC je celkem 15 úrovní přerušení, a tedy patnáct možností, jak upozornit procesor, že se něco děje. Na tom by nebylo nic zvláštního a číslo patnáct se zdá dostatečně veliké na to, aby se těch několik karet v počítači v pohodě obsloužilo (tak nějak si to pánové ve švýcarském IBM představovali, když někdy v r. 1980 drátovali na univerzální desce prvního pradědečka dnešních PC (čest jejich památce, ale první Amiga s krycím názvem Lorraine měla alespoň solidní plošné spoje sešroubované do tří přibližně krychlových útvarů s celkovým objemem asi tak 30 litrů!), potíž je ale v tom, že i bez přídavných desek se toho v počítači děje tolik, že valná část z oněch patnácti přerušení je obsazena ještě dříve, než zasunete první kartu. Z tohoto faktu a z potřeby, aby některé karty na tom ve vztahu k procesoru byly lépe než jiné (měly vyšší prioritu; je například vhodné, aby se na pár setinek sekundy pozastavilo překreslování obrazovky, když k vám po modemové lince proudí životně důležitá data, nebo atomový reaktor hlásí, že se v tom vedru nedá pracovat), končí zmíněné problémy u hodné černé magie.
Srdcem Amigy jsou procesory Motorola, které, nechány bez pomoci externích obvodů, poskytují osm úrovní činnosti (pracovní režim, šest úrovní přerušení a jedno nemaskovatelné přerušení). Za pomoci zákaznických čipů Amigy je toto číslo rozšířeno na patnáct úrovní přerušení - jako u PC. Zde ovšem všechna podobnost s PC končí. Bude jistě překvapením, že pro obsluhu přídavných karet má Amiga k dispozici pouhá dvě přerušení. Jedno s nízkou (4) a jedno s vysokou (14) prioritou. Přitom Amiga 4000 Tower má sloty pro pět přídavných karet, dvě videokarty a pět karet ISA (PC). Jak se s tímto nepoměrem Amiga vyrovnává? O obsluhu přerušení se na Amize stará jádro systému - tzv. Exec. Součástí přerušovacího systému jsou handlery a servery přerušení.
Handler je rutina, která má výhradní právo obsluhovat jako jediná jistý typ přerušení. Handlery obsluhují sériovou linku, disketovou jednotku, blitter a audiokanály. Místo handlerů můžeme použít k obsluze přerušení i tzv. servery. Zatímco handler je pro jedno přerušení jen jeden, serverů obsluhujících jedno přerušení může být více. Servery jsou organizovány v pořadí priorit od -128 do 127. Na jedno přerušení může tedy teoreticky číhat 256 serverů. Jejich zvláštností je, že se mohou rozhodovat, zda poskytnou přerušení dalším s nižší prioritou, nebo zda tok zpracování přeruší a navrátí procesor do normálního stavu. Stará-li se o každou kartu jeden server, dvě přerušení mohou tedy teoreticky obsloužit až 512 karet. A žádná újma se nestane ani ostatním serverům přerušení, které obsluhují copper, vertikální zatemňovací impulz, paralelní port a dokonce i nemaskovatelné přerušení.
Servery se nezabývají zpracováním události, která vyvolala přerušení, ale většinou ji pouze registrují a vyhodnocují. Vlastní zpracování probíhá na jiné úrovni systému mechanismem “zpráv a událostí”. Toto je další ze zaklínadel moderních operačních systémů - systém řízení událostmi (events driven system), ale o nich zase někdy příště.
Pavel Kebort

V-LAB Y-C : digitizér obrazu v reálném čase
Po sérii recenzí programových produktů pro počítače Amiga je čas představit také nějaký ten hardware. Jelikož videografika je počítačům Amiga nejbližší, vybral jsem k recenzi videodigitizér V-Lab.

Více tváří V-Labu
Označení “V-Lab” nese ve svém názvu hned několik karet od firmy MacroSystem. Neuškodí tedy na začátku uvést přehled jejich typů i s krátkým komentářem, aby bylo jasné, která karta byla vybrána k testování a co od ní můžeme čekat.
V-Lab Y-C je interní  realtime digitizér pro A2000, A3000, A4000. Vsouvá se do Zorro II slotu. Digitalizuje jeden snímek z běžícího videa (videokamery...). Pracuje s plným rozlišením 720 x 600 ve 24 bitech. Vstupy: Composite (VHS) a Y-C (S-VHS, Hi8). Cena:  cca 11 000 Kč (testuji  tuto kartu).
V-Lab/par je externí realtime digitizér pro Amigu 1200. Připojuje se na paralelní port. Digitalizuje jeden snímek z běžícího videa (videokamery...). Pracuje s plným rozlišením 720 x 600 ve 24 bitech. Vstupy: Composite (VHS) pouze! Cena: cca 13 000 Kč.
V-Lab/par Y-C je stejný jako V-Lab/par. Vstupy: Composite (VHS) a Y-C (S-VHS, Hi8). Cena: cca 16 000 Kč.
V-Lab Motion je interní realtime  digitizér pro Amigy 3000, 4000. Vsouvá se do Zorro III slotu. Digitalizuje 25 snímků za sekundu (živý obraz), ten v reálném čase komprimuje a ukládá na pevný disk. Má ještě další funkce a spolupracuje s dalšími hardwarovými doplňky. Vstupy: Composite (VHS) a Y-C (S-VHS, Hi8).  Cena: 42 000 Kč (!).

Co všechno potřebuji...
Minimální konfigurace pro V-Lab je Amiga 2000, 3000, 4000 s 1 MB CHIP RAM a 2 MB FAST RAM, Amiga OS 2.0 (KickStart V37.175) a výše, pevný disk 100 MB.
Osobně bych doporučil Amigu 4000 s 2 MB CHIP RAM, 4 MB FAST RAM a velký pevný disk. Software dodávaný k V-Labu podporuje 24bitové grafické karty Retina a Harlequin. Jelikož jsem testoval kartu na A4000 s Picassem II, nemohl jsem nabízených výhod využít. Doufám (snad ne marně), že Escom dokončí výkonné AAA čipy s 24bitovou grafikou a co nejdříve jimi osadí nové Amigy, aby se i na nich nerozmohla móda software + spousta ovladačů pro grafické karty od mnoha výrobců.

Po rozbalení...
Ačkoli se obal tváří zcela německy, dokumentaci je možno zvolit i anglickou. Je psána středně obtížnou angličtinou (němčinou), a najdete v ní téměř vše, co při práci s V-Labem potřebujete, v některých místech je však příliš stručná. Instalace karty je jednoduchá. Otevřete Amigu, vsunete kartu do slotu a zavřete Amigu. Karta je autokonfigurační, Amiga ji sama rozpozná už při zapnutí. Proč je to na Amigách možné a na PC přes slogany plug and play ne, o tom se více dozvíte z předchozího článku ing. Keborta. 
Instalace digitalizačního softwaru proběhla bez problémů standardním Commodore Installerem. Ještě je třeba připojit vstup videosignálu (používal jsem Composite ze čtyřhlavého VHS videa) a může se začít pracovat.

Ještě ke kartě...
Než se budu věnovat softwarově-uživatelské části produktu, zmíním se ještě trochu o kartě; už bylo uvedeno, že jde o Zorro II kartu. Přestože tento slot má šířku pouze 16 bitů, úplně pro svoji funkci postačuje, neboť na kartě je umístěna 768 KB velká rychlá paměť, kam se obrázek digitalizuje. Na jeho pozdější přesun jinam (do RAM, na pevný disk...) už nikdo tak moc nespěchá. Proto je možné připojit kartu v externím provedení i k paralelnímu portu Amigy 1200.

A co vlastně umí...
Karta v reálném čase digitalizuje snímek z externího zdroje videosignálu a uloží ho na disk. Pracuje v plném televizním rozlišení ve 24bitové barevné hloubce. Dodávaný program umožňuje nastavení velikosti a rozlišení digitalizovaného obrazu, barevných korekcí, šumového filtru, speciálních filtrů pro černobílý a barevný obraz atd. Při nízkých kvalitách signálu je užitečná funkce DeInterlace - odstraní vzájemný posun sudých a lichých řádků vznikající u některých zdrojů videosignálu. Komfort je dovršen “preview” okénkem, kde sledujete obraz ze vstupu (viz obrázek).

Nahrávání sekvencí...
V-Lab umožňuje také snímat sekvence obrázků. Nastavíte si prodlevy mezi snímky a jejich počet. Obvykle karta stihne sejmout jeden až dva snímky za sekundu. Záleží na rozlišení a na rychlosti média, na které data ukládáte.

IRF...
Mezi nejsilnější funkce V-Labu však určitě patří způsob digitalizace IRF (Interleaved Frame Recording), lze jej však použít jen tehdy, pokud digitalizujete pasáž z magnetického média (pásky). IRF umožňuje digitalizovat libovolně dlouhou animaci v plném počtu snímků. Jak to dokáže? Filozofie IRF je velmi prostá: začnete přehrávat záznam alespoň 20 sekund před místem, které chcete digitalizovat. Software si najde na pásce “klíčový” snímek, který později s jistotou rozpozná. Vy pak stiskem myši označíte začátek pasáže, kterou chcete digitalizovat. Program si zapamatuje přesný čas mezi “klíčovým” snímkem a začátkem pasáže. Pak digitalizuje předem zadaný počet snímků takovou rychlostí, jakou stačí přenášet data z bufferu do RAM: Například snímky 0000, 0010, 0020, 0030... Pak je třeba kazetu přetočit zpět, program si najde svůj “klíčový” snímek, odpočítá začátek scény a digitalizuje obrázky 0001, 0011, 0021, 0031... Kazetu přetočíte asi desetkrát a máte sekvenci 25 obrázků za sekundu v plném rozlišení a ve 24bitové kvalitě. Tento způsob digitalizace je náročný na kapacitu pevného disku.

Podpora...
Program má samozřejmě Arexx port, přes který lze pomocí asi 100 příkazů kartu plně ovládat. Já jsem použil z Arexxu pouze předprogramovaný skript, který mi přemisťoval data při IRF záznamu z RAM: na pevný disk.
S kartou se dodává také “Loader” pro program ADPro (viz minulé číslo Chipu), který umí nejen přímo nahrávat speciální formát obrázků V-Labu, ale také digitalizovat přímo z karty, bez spouštění výše popisovaného programu. Přicházíte sice o mnoho výhod, ale někdy se to může hodit.
Komfortnější je digitalizace ze 24bitového programu TV-paint. Má v sobě podporu pro V-Lab a pro digitalizaci JEDNOTLIVÝCH obrázků jej mohu doporučit ještě více než program dodávaný s kartou. TV-paint poskytuje také okno “preview”, funkci “DeInterlace”, sejmutý obraz přímo zobrazí ve 24bitové kvalitě a vy jej můžete ihned dále zpracovávat. Snímání sekvencí a metodu IRF samozřejmě neumí. Zato je k dispozici snad všem existujícím 24bitovým kartám pro Amigu. V-Lab (dle výrobce) podporují další programy (VDPaint, ClariSSA...).

Slovo závěrem...
Celkově lze V-Lab vzhledem k jeho ceně označit za velmi dobrý výrobek. Ačkoli nedigitalizuje pohyblivé video v reálném čase jako V-Lab Motion, IRF je ideální kompromis mezi pohodlím a cenou. Možná výrobce mohl přibalit i propojovací kabely, neboť v příručce tvrdí, že stíněné zvukové ne- dostačují a mohou znatelně snížit kvalitu videosignálu! Zneklidňovalo mě citelné zahřívání řídicího čipu na kartě, ale ani po několikadenním nepřetržitém provozu nedošlo k žádným problémům. Pokud bych měl V-Lab někomu nedoporučit, byli by to uživatelé VHS videí. Kvalita VHS je v porovnání s kvalitou digitizéru nízká a V-Lab pak působí jako “kanón na vrabce”.
